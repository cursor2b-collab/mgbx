# æ•°æ®åº“è®¾ç½®å®Œæˆ

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®åº“è¡¨ç»“æ„

å·²æˆåŠŸåˆ›å»ºä»¥ä¸‹æ•°æ®è¡¨ï¼š

#### æ ¸å¿ƒè¡¨
- **user_assets** - ç”¨æˆ·èµ„äº§è¡¨
  - å­˜å‚¨ç”¨æˆ·çš„åŠ å¯†è´§å¸èµ„äº§ï¼ˆä½™é¢ã€ä»·æ ¼ã€æ”¶ç›Šç­‰ï¼‰
  - æ”¯æŒå¤šå¸ç§ç®¡ç†
  - è‡ªåŠ¨è®¡ç®— USD ä»·å€¼

- **transactions** - äº¤æ˜“è®°å½•è¡¨
  - å­˜å‚¨æ‰€æœ‰äº¤æ˜“è®°å½•ï¼ˆå……å€¼ã€æç°ã€ä¹°å–ã€è½¬è´¦ï¼‰
  - æ”¯æŒçŠ¶æ€è·Ÿè¸ªï¼ˆå·²å®Œæˆã€å¾…å¤„ç†ã€å¤±è´¥ï¼‰

- **orders** - è®¢å•è¡¨
  - å­˜å‚¨äº¤æ˜“è®¢å•ï¼ˆé™ä»·ã€å¸‚ä»·ã€æ­¢æŸï¼‰
  - è·Ÿè¸ªè®¢å•çŠ¶æ€å’Œæˆäº¤æƒ…å†µ

- **trades** - äº¤æ˜“è¡¨
  - å­˜å‚¨å·²æ‰§è¡Œçš„äº¤æ˜“è®°å½•
  - åŒ…å«äº¤æ˜“å¯¹ã€ä»·æ ¼ã€æ•°é‡ã€æ‰‹ç»­è´¹ç­‰ä¿¡æ¯

#### èµ„é‡‘ç®¡ç†è¡¨
- **deposits** - å……å€¼è®°å½•è¡¨
  - è®°å½•ç”¨æˆ·å……å€¼æ“ä½œ
  - æ”¯æŒå¤šç½‘ç»œï¼ˆTRC20ã€ERC20ã€BEP20ç­‰ï¼‰
  - è·Ÿè¸ªç¡®è®¤çŠ¶æ€

- **withdraws** - æç°è®°å½•è¡¨
  - è®°å½•ç”¨æˆ·æç°æ“ä½œ
  - æ”¯æŒæ‰‹ç»­è´¹è®¡ç®—
  - è·Ÿè¸ªå¤„ç†çŠ¶æ€

#### å…¶ä»–åŠŸèƒ½è¡¨
- **kyc_applications** - KYC ç”³è¯·è¡¨
  - å­˜å‚¨ç”¨æˆ· KYC è®¤è¯ç”³è¯·
  - æ”¯æŒå¤šç§è¯ä»¶ç±»å‹
  - å®¡æ ¸çŠ¶æ€ç®¡ç†

- **ipo_projects** - IPO é¡¹ç›®è¡¨
  - å­˜å‚¨ IPO é¡¹ç›®ä¿¡æ¯
  - æ”¯æŒé¡¹ç›®çŠ¶æ€è·Ÿè¸ª

- **admin_users** - ç®¡ç†å‘˜è¡¨
  - å­˜å‚¨ç®¡ç†å‘˜ç”¨æˆ·ä¿¡æ¯
  - æ”¯æŒè§’è‰²å’Œæƒé™ç®¡ç†

### 2. å®‰å…¨é…ç½®

#### Row Level Security (RLS)
- âœ… æ‰€æœ‰è¡¨å·²å¯ç”¨ RLS
- âœ… ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- âœ… IPO é¡¹ç›®å…¬å¼€å¯è¯»
- âœ… ç®¡ç†å‘˜æƒé™å—æ§

#### ç­–ç•¥é…ç½®
- ç”¨æˆ·èµ„äº§ï¼šç”¨æˆ·åªèƒ½æŸ¥çœ‹å’Œä¿®æ”¹è‡ªå·±çš„èµ„äº§
- äº¤æ˜“è®°å½•ï¼šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„äº¤æ˜“è®°å½•
- è®¢å•ï¼šç”¨æˆ·åªèƒ½ç®¡ç†è‡ªå·±çš„è®¢å•
- KYCï¼šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„ç”³è¯·
- å……å€¼å’Œæç°ï¼šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„è®°å½•

### 3. æ•°æ®åº“å‡½æ•°

#### initialize_user_assets
- è‡ªåŠ¨åˆå§‹åŒ–ç”¨æˆ·èµ„äº§
- åˆ›å»ºé»˜è®¤èµ„äº§ï¼ˆUSDTã€BTCã€ETHï¼‰
- åˆ›å»ºåˆå§‹äº¤æ˜“è®°å½•

### 4. å‰ç«¯é›†æˆ

#### æ•°æ®åº“æœåŠ¡ (`src/services/database.ts`)
å·²åˆ›å»ºå®Œæ•´çš„æ•°æ®åº“æœåŠ¡å±‚ï¼š
- `assetService` - èµ„äº§ç®¡ç†
- `transactionService` - äº¤æ˜“è®°å½•ç®¡ç†
- `orderService` - è®¢å•ç®¡ç†
- `tradeService` - äº¤æ˜“ç®¡ç†
- `depositService` - å……å€¼ç®¡ç†
- `withdrawService` - æç°ç®¡ç†

#### ç»„ä»¶æ›´æ–°
- âœ… `AssetsPage.tsx` - å·²æ›´æ–°ä¸ºä½¿ç”¨çœŸå®æ•°æ®åº“
- âœ… è‡ªåŠ¨åˆå§‹åŒ–ç”¨æˆ·èµ„äº§
- âœ… å®æ—¶æ•°æ®åŒæ­¥

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„è¯¦æƒ…

### user_assets
```sql
- id (UUID, Primary Key)
- user_id (UUID, Foreign Key -> auth.users)
- symbol (TEXT) - å¸ç§ç¬¦å·
- name (TEXT) - å¸ç§åç§°
- icon (TEXT) - å›¾æ ‡URL
- balance (NUMERIC) - æ€»ä½™é¢
- available_balance (NUMERIC) - å¯ç”¨ä½™é¢
- frozen_balance (NUMERIC) - å†»ç»“ä½™é¢
- usd_value (NUMERIC) - USDä»·å€¼
- price (NUMERIC) - å½“å‰ä»·æ ¼
- change_24h (NUMERIC) - 24å°æ—¶æ¶¨è·Œ
- avg_buy_price (NUMERIC) - å¹³å‡ä¹°å…¥ä»·
- profit (NUMERIC) - æ”¶ç›Š
- profit_percent (NUMERIC) - æ”¶ç›Šç‡
- created_at, updated_at
```

### transactions
```sql
- id (UUID, Primary Key)
- user_id (UUID, Foreign Key -> auth.users)
- type (TEXT) - deposit/withdraw/buy/sell/transfer
- asset (TEXT) - èµ„äº§ç±»å‹
- amount (NUMERIC) - æ•°é‡
- status (TEXT) - completed/pending/failed
- tx_hash (TEXT) - äº¤æ˜“å“ˆå¸Œ
- created_at, updated_at
```

### orders
```sql
- id (UUID, Primary Key)
- user_id (UUID, Foreign Key -> auth.users)
- pair (TEXT) - äº¤æ˜“å¯¹
- side (TEXT) - buy/sell
- type (TEXT) - limit/market/stop
- amount (NUMERIC) - æ•°é‡
- price (NUMERIC) - ä»·æ ¼
- filled_amount (NUMERIC) - å·²æˆäº¤æ•°é‡
- status (TEXT) - pending/filled/partially_filled/cancelled/failed
- fee (NUMERIC) - æ‰‹ç»­è´¹
- fee_asset (TEXT) - æ‰‹ç»­è´¹å¸ç§
- created_at, updated_at
```

## ğŸ” å®‰å…¨ç‰¹æ€§

1. **RLS ç­–ç•¥**
   - æ‰€æœ‰è¡¨å¯ç”¨è¡Œçº§å®‰å…¨
   - ç”¨æˆ·æ•°æ®éš”ç¦»
   - é˜²æ­¢æœªæˆæƒè®¿é—®

2. **æ•°æ®å®Œæ•´æ€§**
   - å¤–é”®çº¦æŸ
   - æ£€æŸ¥çº¦æŸï¼ˆçŠ¶æ€å€¼ã€ç±»å‹å€¼ï¼‰
   - å”¯ä¸€çº¦æŸ

3. **è‡ªåŠ¨æ—¶é—´æˆ³**
   - created_at è‡ªåŠ¨è®¾ç½®
   - updated_at è‡ªåŠ¨æ›´æ–°

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åˆå§‹åŒ–ç”¨æˆ·èµ„äº§
```typescript
import { assetService } from '../services/database';

// è‡ªåŠ¨åˆå§‹åŒ–ï¼ˆé¦–æ¬¡ç™»å½•æ—¶ï¼‰
await assetService.initializeAssets(userId);
```

### è·å–ç”¨æˆ·èµ„äº§
```typescript
const assets = await assetService.getUserAssets(userId);
```

### è·å–äº¤æ˜“è®°å½•
```typescript
const transactions = await transactionService.getUserTransactions(userId);
```

### åˆ›å»ºè®¢å•
```typescript
const order = await orderService.createOrder(userId, {
  pair: 'BTC/USDT',
  side: 'buy',
  type: 'limit',
  amount: 0.1,
  price: 45000,
  fee: 0.001,
  status: 'pending',
});
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡ä½¿ç”¨**
   - ç”¨æˆ·é¦–æ¬¡è®¿é—®èµ„äº§é¡µé¢æ—¶ä¼šè‡ªåŠ¨åˆå§‹åŒ–èµ„äº§
   - é»˜è®¤åˆ›å»º USDTã€BTCã€ETH èµ„äº§
   - åˆå§‹ USDT ä½™é¢ï¼š10,000

2. **æ•°æ®è¿ç§»**
   - å¦‚æœå·²æœ‰æ¨¡æ‹Ÿæ•°æ®ï¼Œéœ€è¦è¿ç§»åˆ°æ–°è¡¨
   - ä½¿ç”¨ Supabase ç®¡ç†ç•Œé¢æˆ– SQL è¿ç§»

3. **æ€§èƒ½ä¼˜åŒ–**
   - æ‰€æœ‰è¡¨å·²åˆ›å»ºç´¢å¼•
   - æŸ¥è¯¢å·²ä¼˜åŒ–
   - å»ºè®®å®šæœŸæ¸…ç†æ—§æ•°æ®

## ğŸ”„ åç»­å·¥ä½œ

1. **æ·»åŠ æ›´å¤šå¸ç§**
   - åœ¨åˆå§‹åŒ–å‡½æ•°ä¸­æ·»åŠ æ›´å¤šé»˜è®¤å¸ç§
   - æ”¯æŒåŠ¨æ€æ·»åŠ æ–°å¸ç§

2. **å®æ—¶ä»·æ ¼æ›´æ–°**
   - é›†æˆä»·æ ¼ API
   - å®šæœŸæ›´æ–°èµ„äº§ä»·æ ¼
   - è®¡ç®—å®æ—¶æ”¶ç›Š

3. **äº¤æ˜“åŠŸèƒ½**
   - å®ç°è®¢å•æ’®åˆ
   - æ·»åŠ äº¤æ˜“å¼•æ“
   - æ‰‹ç»­è´¹è®¡ç®—

4. **æ•°æ®ç»Ÿè®¡**
   - åˆ›å»ºè§†å›¾å’Œèšåˆå‡½æ•°
   - æ·»åŠ æ•°æ®æŠ¥è¡¨
   - æ€§èƒ½ç›‘æ§

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `src/services/database.ts` - æ•°æ®åº“æœåŠ¡å±‚
- `src/components/AssetsPage.tsx` - èµ„äº§é¡µé¢ï¼ˆå·²æ›´æ–°ï¼‰
- Supabase é¡¹ç›® ID: `bxeubvjivqbbbhzngycf`

## âœ… éªŒè¯æ¸…å•

- [x] æ‰€æœ‰è¡¨å·²åˆ›å»º
- [x] RLS å·²å¯ç”¨
- [x] ç´¢å¼•å·²åˆ›å»º
- [x] å¤–é”®çº¦æŸå·²è®¾ç½®
- [x] æ•°æ®åº“å‡½æ•°å·²åˆ›å»º
- [x] å‰ç«¯æœåŠ¡å±‚å·²åˆ›å»º
- [x] ç»„ä»¶å·²æ›´æ–°
- [x] é”™è¯¯å¤„ç†å·²å®ç°

